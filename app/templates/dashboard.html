<!-- app/templates/dashboard.html -->
{% extends "base.html" %}

{% block content %}
<div class="text-center mb-6">
    <h1 class="display-5 fw-bold text-primary">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.user }}!</h1>
    <p class="lead text-muted mt-2">–í–∞—à –ª–∏—á–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ üí¨</p>
    <div class="d-flex justify-content-center mt-3">
        <span class="badge bg-success rounded-pill px-4 py-2 fs-6">
            <i class="bi bi-star-fill text-warning me-1"></i>–£ –≤–∞—Å {{ mastered_words }} –æ—Å–≤–æ–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
        </span>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
<div class="row mb-6 g-4">
    <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-graph-up text-primary fs-3 me-3"></i>
                    <h5 class="card-title mb-0">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</h5>
                </div>
                <div class="mb-4">
                    <div class="d-flex justify-content-between mb-2">
                        <small class="text-muted">–í—Å–µ–≥–æ —Å–ª–æ–≤</small>
                        <strong>{{ total_words }}</strong>
                    </div>
                    <div class="progress mb-3" style="height: 8px;">
                        <div class="progress-bar bg-info" role="progressbar"
                             style="width {{ (mastered_words / total_words * 100)|round(0) }}%;"
                             aria-valuenow="{{ (mastered_words / total_words * 100)|round(0) }}"
                             aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small class="text-muted">–û—Å–≤–æ–µ–Ω–æ</small>
                        <strong class="text-success">{{ mastered_words }} ({{ (mastered_words / total_words *
                            100)|round(1) }}%)</strong>
                    </div>
                </div>
                {% if last_reviewed != "–ù–∏–∫–æ–≥–¥–∞" %}
                <div class="mt-auto pt-3 border-top">
                    <small class="text-muted"><i class="bi bi-clock-history me-1"></i> –ü–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ: {{
                        last_reviewed.strftime('%d.%m.%Y %H:%M') if last_reviewed else "–ù–∏–∫–æ–≥–¥–∞" }}</small>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è—Ö -->
    <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0 bg-gradient"
             style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
            <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-bell-fill fs-3 me-3"></i>
                    <h5 class="card-title mb-0">üîî –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</h5>
                </div>
                {% if pending_reviews|length > 0 %}
                <p class="fs-5 mb-3">
                    –£ –≤–∞—Å <strong>{{ pending_reviews|length }}</strong> —Å–ª–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ!
                </p>
                <a href="/test?category=pending" class="btn btn-light text-dark fw-semibold shadow-sm">
                    –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—é ‚Üí
                </a>
                {% else %}
                <p class="fs-5 mb-3">–ù–µ—Ç —Å–ª–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ. –û—Ç–ª–∏—á–Ω–æ!</p>
                <a href="/test" class="btn btn-outline-light fw-semibold shadow-sm">
                    –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç ‚Üí
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –ë–æ–Ω—É—Å: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è -->
    <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body d-flex flex-column">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-lightbulb-fill text-warning fs-3 me-3"></i>
                    <h5 class="card-title mb-0">üí° –°–æ–≤–µ—Ç –¥–Ω—è</h5>
                </div>
                <p class="mb-4 fst-italic">
                    ‚Äú–õ—É—á—à–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å 5 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á–µ–º 1 —á–∞—Å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.‚Äù
                </p>
                <a href="/add_word" class="btn btn-outline-primary w-100">
                    <i class="bi bi-plus-circle me-1"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ
                </a>
            </div>
        </div>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤ -->
<div class="row g-4 mb-6">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="h5 fw-bold text-secondary">–ú–æ–∏ —Å–ª–æ–≤–∞</h3>
            <div class="d-flex gap-2">
                <select class="form-select form-select-sm w-auto" id="filterWords" style="max-width: 180px;">
                    <option value="all">–í—Å–µ —Å–ª–æ–≤–∞</option>
                    <option value="beginner">–ù–∞—á–∏–Ω–∞—é (0‚Äì39%)</option>
                    <option value="learning">–£—á—É (40‚Äì79%)</option>
                    <option value="mastered">–û—Å–≤–æ–∏–ª (‚â•80%)</option>
                </select>
                <input type="text" class="form-control form-control-sm w-auto" id="searchWords" placeholder="–ü–æ–∏—Å–∫..."
                       style="max-width: 180px;">
            </div>
        </div>
    </div>

    {% if words|length == 0 %}
    <div class="col-12 text-center py-5">
        <i class="bi bi-book-half text-muted fs-1 mb-3"></i>
        <h5 class="text-muted">–í—ã –µ—â—ë –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–∏ –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞</h5>
        <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö —Å–ª–æ–≤ ‚Äî –∏ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å!</p>
        <a href="/add_word" class="btn btn-primary mt-3">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ</a>
    </div>
    {% else %}
    {% for uw in words %}
    <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 shadow-sm border-0 hover-card">
            <div class="card-body p-4 d-flex flex-column">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5 class="card-title text-primary m-0">{{ uw.word.english }}</h5>
                    <span class="badge {% if uw.progress >= 80 %}bg-success{% elif uw.progress >= 40 %}bg-warning{% else %}bg-danger{% endif %} fs-7 px-2 py-1">
                            {{ uw.progress }}%
                        </span>
                </div>
                <p class="card-text text-muted mb-3">{{ uw.word.russian }}</p>

                <div class="progress mb-3 flex-grow-1" style="height: 8px;">
                    <div class="progress-bar {% if uw.progress < 40 %}bg-danger{% elif uw.progress < 80 %}bg-warning{% else %}bg-success{% endif %}"
                         role="progressbar"
                         style="width {{ uw.progress }}%;"
                         aria-valuenow="{{ uw.progress }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>

                <small class="text-muted mt-auto">
                    {% if uw.progress < 40 %}
                    üîπ –ù–∞—á–∏–Ω–∞–µ–º
                    {% elif uw.progress < 80 %}
                    üîπ –£—á–∏–º
                    {% else %}
                    ‚úÖ –ó–∞–ø–æ–º–Ω–µ–Ω–æ
                    {% endif %}
                </small>
            </div>
        </div>
    </div>
    {% endfor %}
    {% endif %}
</div>

<!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
<div class="text-center mt-5 pb-5">
    <a href="/add_word" class="btn btn-outline-primary btn-lg me-3 px-5">
        <i class="bi bi-plus-circle me-2"></i> –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ
    </a>
    <a href="/test" class="btn btn-success btn-lg px-5">
        <i class="bi bi-clipboard-check me-2"></i> –ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç
    </a>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchWords');
        const filterSelect = document.getElementById('filterWords');
        const cards = document.querySelectorAll('.col-lg-4');

        function filterWords() {
            const searchTerm = searchInput.value.toLowerCase();
            const filterValue = filterSelect.value;

            cards.forEach(card => {
                const english = card.querySelector('.card-title').textContent.toLowerCase();
                const russian = card.querySelector('.card-text').textContent.toLowerCase();
                const progress = parseInt(card.querySelector('.progress-bar').getAttribute('aria-valuenow'));

                let matchSearch = !searchTerm || english.includes(searchTerm) || russian.includes(searchTerm);
                let matchFilter = true;

                if (filterValue === 'beginner') matchFilter = progress < 40;
                else if (filterValue === 'learning') matchFilter = progress >= 40 && progress < 80;
                else if (filterValue === 'mastered') matchFilter = progress >= 80;

                card.style.display = (matchSearch && matchFilter) ? 'block' : 'none';
            });
        }

        searchInput.addEventListener('input', filterWords);
        filterSelect.addEventListener('change', filterWords);
    });
</script>

<style>
    .hover-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .bg-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .progress-bar {
        border-radius: 4px;
    }

    .badge {
        font-weight: 600;
    }

    /* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 768px) {
        .d-flex.justify-content-between.align-items-center.mb-4 {
            flex-direction: column;
            align-items: stretch;
            gap: 1rem;
        }

        .d-flex.gap-2 {
            flex-direction: column;
        }
    }
</style>
{% endblock %}